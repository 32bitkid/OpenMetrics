syntax = "proto3";

package openmetrics;

import "google/protobuf/timestamp.proto";

message MetricSet {
  repeated MetricFamily metric_families = 1;
}

message MetricFamily {
  string name = 1;

  MetricType type = 2;

  string unit = 3;

  string help = 4;

  repeated Metric metrics = 5;
}

enum MetricType {
  UNKNOWN = 0;
  GAUGE = 1;
  COUNTER = 2;
  STATE_SET = 3;
  INFO = 4;
  HISTOGRAM = 5;
  GAUGE_HISTOGRAM = 6;
  SUMMARY = 7;
}

message Metric {
  repeated Label labels = 1;

  repeated Point points = 2;
}

message Label {
  string name = 1;

  string value = 2;
}

message Point {
  oneof value {
    UnknownValue unknown_value = 1;
    GaugeValue gauge_value = 2;
    CounterValue counter_value = 3;
    HistogramValue histogram_value = 4;
    StateSetValue state_set_value = 5;
    InfoValue info_value = 6;
    SummaryValue summary_value = 7;
  }

  google.protobuf.Timestamp timestamp = 8;
}

message UnknownValue {
  oneof value {
    double double_value = 1;
    int64 int_value = 2;
  }
}

message GaugeValue {
  oneof value {
    double double_value = 1;
    int64 int_value = 2;
  }
}

message CounterValue {
  oneof total {
    double double_value = 1;
    uint64 int_value = 2;
  }

  google.protobuf.Timestamp created = 3;

  Exemplar exemplar = 4;
}

message HistogramValue {
  oneof sum {
    double double_value = 1;
    int64 int_value = 2;
  }

  uint64 count = 2;

  google.protobuf.Timestamp created = 3;

  BucketOptions bucket_options = 4;

  message BucketOptions {
    oneof options {
      Linear linear_buckets = 1;

      Exponential exponential_buckets = 2;

      Explicit explicit_buckets = 3;
    }

    message Linear {
      uint32 num_explicit_buckets = 1;

      double width = 2;

      double offset = 3;
    }

    message Exponential {
      uint32 num_exponential_buckets = 1;

      double growth_factor = 2;

      double scale = 3;
    }

    message Explicit {
      repeated double bounds = 1;
    }
  }

  repeated BucketCount bucket_counts = 5;

  message BucketCount {
    uint64 count = 1;

    Exemplar exemplar = 2;
  }
}

message Exemplar {
  double value = 1;

  google.protobuf.Timestamp timestamp = 2;

  repeated Label label = 3;
}

message StateSetValue {
  repeated State states = 1;

  message State {
    bool enabled = 1;

    string name = 2;
  }
}

message InfoValue {
  repeated Label info = 1;
}

message SummaryValue {
  oneof sum {
    double double_value = 1;
    int64 int_value = 2;
  }

  uint64 count = 2;

  google.protobuf.Timestamp created = 3;

  repeated Quantile quantile = 4;

  message Quantile {
    double quantile = 1;

    double value = 2;
  }
}
